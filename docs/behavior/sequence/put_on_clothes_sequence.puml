@startuml Mark_Item_Worn_Sequence
title –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç–º–µ—Ç–∫–∏ –≤–µ—â–∏ –∫–∞–∫ –Ω–∞–¥–µ—Ç–æ–π

actor "üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" as User
participant "üì± –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å" as UI
participant "üéÆ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä" as Controller
participant "üõ†Ô∏è –°–µ—Ä–≤–∏—Å –≥–∞—Ä–¥–µ—Ä–æ–±–∞" as WardrobeService
participant "üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö" as DB
participant "üìä –°–µ—Ä–≤–∏—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏" as StatsService

User -> UI: –ù–∞–∂–∏–º–∞–µ—Ç "–ù–∞–¥–µ–ª —Å–µ–≥–æ–¥–Ω—è" –Ω–∞ –≤–µ—â–∏
activate User
activate UI

UI -> Controller: PATCH /api/wardrobe/items/{id}/worn\n{\n  "wear_date": "2024-12-15",\n  "occasion": "—Ä–∞–±–æ—Ç–∞",\n  "weather": "—è—Å–Ω–æ, +20¬∞C"\n}
activate Controller

Controller -> WardrobeService: markItemAsWorn(item_id, wearData)
activate WardrobeService

WardrobeService -> DB: UPDATE ClothingItems\nSET last_worn = ?, wear_count = wear_count + 1\nWHERE item_id = ?
activate DB
DB -> WardrobeService: rows_affected
deactivate DB

WardrobeService -> DB: INSERT INTO WearHistory\n(item_id, wear_date, occasion, weather, user_id)
activate DB
DB -> WardrobeService: wear_history_id
deactivate DB

WardrobeService -> WardrobeService: checkWearFrequency(item_id)
activate WardrobeService

alt –í–µ—â—å –Ω–µ –Ω–æ—Å–∏–ª–∞—Å—å > 30 –¥–Ω–µ–π
    WardrobeService -> UI: suggestToRemoveItem(item_id)
    WardrobeService -> StatsService: trackInfrequentItem(item_id, user_id)
    activate StatsService
    StatsService -> StatsService: updateInfrequentItemsReport(user_id)
    deactivate StatsService
end

WardrobeService -> StatsService: updateWearStatistics(user_id, item_id)
activate StatsService
StatsService -> DB: UPDATE UserStats\nSET total_wears = total_wears + 1,\nlast_wear_date = ?\nWHERE user_id = ?
activate DB
DB -> StatsService: stats_updated
deactivate DB
deactivate StatsService

WardrobeService -> Controller: SuccessResponse({\n  message: "–í–µ—â—å –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –Ω–∞–¥–µ—Ç–æ–π",\n  wear_count: new_count,\n  last_worn: date\n})
deactivate WardrobeService

Controller -> UI: 200 OK\n{\n  "success": true,\n  "wear_count": 5,\n  "last_worn": "2024-12-15"\n}
deactivate Controller

UI -> UI: –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –Ω–æ—Å–∫–∏ (+1)
UI -> UI: –û–±–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–π –Ω–æ—Å–∫–∏
UI -> UI: –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "‚úÖ –û—Ç–º–µ—á–µ–Ω–æ!"

alt –ë—ã–ª–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —É–¥–∞–ª–∏—Ç—å –≤–µ—â—å
    UI -> User: –ü–æ–∫–∞–∑–∞—Ç—å suggestion:\n"–≠—Ç–∞ –≤–µ—â—å –Ω–µ –Ω–æ—Å–∏–ª–∞—Å—å 45 –¥–Ω–µ–π.\n–£–¥–∞–ª–∏—Ç—å –∏–∑ –≥–∞—Ä–¥–µ—Ä–æ–±–∞?"
end

UI -> User: –í–µ—â—å –≤–∏–∑—É–∞–ª—å–Ω–æ –≤—ã–¥–µ–ª–µ–Ω–∞\n(–∏–∫–æ–Ω–∫–∞ "–Ω–µ–¥–∞–≤–Ω–æ –Ω–∞–¥–µ—Ç–∞")
deactivate UI
deactivate User
@enduml
