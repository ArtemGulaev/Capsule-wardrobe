@startuml
title –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ–±–∑–æ—Ä–∞ –≥–∞—Ä–¥–µ—Ä–æ–±–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

actor "üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" as User
participant "üì± –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å" as UI
participant "üéÆ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä" as Controller
participant "üõ†Ô∏è –°–µ—Ä–≤–∏—Å –≥–∞—Ä–¥–µ—Ä–æ–±–∞" as WardrobeService
participant "üìä –°–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏" as AnalyticsService
participant "üå§Ô∏è –°–µ—Ä–≤–∏—Å –ø–æ–≥–æ–¥—ã" as WeatherService
participant "üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö" as DB

== –£—Ç—Ä–µ–Ω–Ω–∏–π –æ–±–∑–æ—Ä –≥–∞—Ä–¥–µ—Ä–æ–±–∞ ==
User -> UI: –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Ç—Ä–æ–º
activate User
activate UI

UI -> Controller: GET /api/wardrobe/daily-overview\n?user_id=123&date=2024-12-15
activate Controller

Controller -> WeatherService: getWeatherForecast(location, date)
activate WeatherService
WeatherService --> Controller: {temp: "+20¬∞C", condition: "—è—Å–Ω–æ", season: "–ª–µ—Ç–æ"}
deactivate WeatherService

Controller -> WardrobeService: getDailyWardrobeSuggestions(user_id, weather)
activate WardrobeService

WardrobeService -> DB: SELECT * FROM ClothingItems\nWHERE user_id = ?\nAND season IN ('–ª–µ—Ç–æ', '–≤—Å–µ—Å–µ–∑–æ–Ω–Ω–æ–µ')\nAND last_worn < DATE('now', '-2 days')\nORDER BY wear_count ASC, is_favorite DESC\nLIMIT 5
activate DB
DB -> WardrobeService: suggested_items
deactivate DB

WardrobeService -> DB: SELECT * FROM Outfits\nWHERE user_id = ?\nAND occasion IN ('–ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–µ', '—Ä–∞–±–æ—Ç–∞')\nAND last_worn < DATE('now', '-7 days')\nORDER BY rating DESC\nLIMIT 3
activate DB
DB -> WardrobeService: suggested_outfits
deactivate DB

WardrobeService -> WardrobeService: prepareDailySuggestions(suggested_items, suggested_outfits, weather)
activate WardrobeService
WardrobeService -> Controller: DailyWardrobeResponse({\n  weather: weather_info,\n  suggestions: item_suggestions,\n  outfits: outfit_suggestions,\n  stats: daily_stats\n})
deactivate WardrobeService

Controller -> UI: 200 OK\n{\n  "weather": {\n    "temp": "+20¬∞C",\n    "condition": "—è—Å–Ω–æ",\n    "recommendation": "–ª–µ–≥–∫–∞—è –æ–¥–µ–∂–¥–∞"\n  },\n  "suggestions": [...],\n  "outfits": [...],\n  "stats": {\n    "total_items": 42,\n    "unworn_30_days": 5,\n    "favorites_count": 12\n  }\n}
deactivate Controller

UI -> UI: –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! üåû"
UI -> UI: –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–≥–æ–¥—É –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
UI -> UI: –í—ã–¥–µ–ª–∏—Ç—å "–≤–µ—â–∏ –¥–ª—è —Å–µ–≥–æ–¥–Ω—è"
UI -> User: –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ\n–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –≥–∞—Ä–¥–µ—Ä–æ–±—É

== –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–∞—Ä–¥–µ—Ä–æ–±–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è ==
loop –î–ª—è –∫–∞–∂–¥–æ–π –Ω–∞–¥–µ—Ç–æ–π –≤–µ—â–∏
User -> UI: –û—Ç–º–µ—á–∞–µ—Ç –≤–µ—â—å –∫–∞–∫ –Ω–∞–¥–µ—Ç—É—é
UI -> Controller: PATCH /api/wardrobe/items/{id}/worn
activate Controller
Controller -> WardrobeService: markItemAsWorn(item_id, wear_data)
activate WardrobeService
WardrobeService -> DB: UPDATE ClothingItems\nSET wear_count = wear_count + 1,\nlast_worn = CURRENT_DATE\nWHERE item_id = ?
activate DB
DB -> WardrobeService: updated
deactivate DB

WardrobeService -> AnalyticsService: trackWearEvent(user_id, item_id, wear_data)
activate AnalyticsService
AnalyticsService -> DB: INSERT INTO WearAnalytics\n(user_id, item_id, date, occasion)\nVALUES (?, ?, ?, ?)
activate DB
DB -> AnalyticsService: tracked
deactivate DB
AnalyticsService --> WardrobeService: analytics_updated
deactivate AnalyticsService

WardrobeService --> Controller: SuccessResponse({\n  wear_count: new_count,\n  message: "–í–µ—â—å –æ—Ç–º–µ—á–µ–Ω–∞"\n})
deactivate WardrobeService
Controller --> UI: 200 OK
deactivate Controller

UI -> UI: –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
UI -> User: –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
end

== –í–µ—á–µ—Ä–Ω—è—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≥–∞—Ä–¥–µ—Ä–æ–±–∞ ==
User -> UI: –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ—Ç—á–µ—Ç –∑–∞ –¥–µ–Ω—å
UI -> Controller: GET /api/wardrobe/daily-report\n?user_id=123&date=2024-12-15
activate Controller

Controller -> AnalyticsService: getDailyWardrobeReport(user_id, date)
activate AnalyticsService

AnalyticsService -> DB: SELECT\n  COUNT(*) as items_worn,\n  GROUP_CONCAT(category) as categories_worn,\n  AVG(wear_count) as avg_wear_count\nFROM WearAnalytics\nWHERE user_id = ? AND date = ?
activate DB
DB --> AnalyticsService: wear_data
deactivate DB

AnalyticsService -> DB: SELECT\n  COUNT(*) as total_items,\n  SUM(CASE WHEN last_worn < DATE('now', '-30 days') THEN 1 ELSE 0 END) as unworn_30_days\nFROM ClothingItems\nWHERE user_id = ?
activate DB
DB --> AnalyticsService: wardrobe_stats
deactivate DB

AnalyticsService -> AnalyticsService: calculateWardrobeEfficiency(wear_data, wardrobe_stats)
activate AnalyticsService
AnalyticsService --> Controller: WardrobeReport({\n  daily_summary: summary,\n  efficiency_score: score,\n  recommendations: recs,\n  unworn_items: list\n})
deactivate AnalyticsService

Controller --> UI: 200 OK\n{\n  "daily_summary": {\n    "items_worn": 3,\n    "categories": ["–≤–µ—Ä—Ö", "–Ω–∏–∑", "–æ–±—É–≤—å"],\n    "efficiency": "65%"\n  },\n  "recommendations": [\n    "5 –≤–µ—â–µ–π –Ω–µ –Ω–æ—Å–∏–ª–∏—Å—å >30 –¥–Ω–µ–π",\n    "–î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –±–∞–∑–æ–≤—ã—Ö —Ü–≤–µ—Ç–æ–≤"\n  ],\n  "achievements": [\n    "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ 3 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞ –¥–µ–Ω—å",\n    "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≥–∞—Ä–¥–µ—Ä–æ–±–∞ +5%"\n  ]\n}
deactivate Controller

UI -> UI: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
UI -> UI: –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–∞—Ä–¥–µ—Ä–æ–±–∞
UI -> User: –ü–æ–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è\n–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
deactivate UI
deactivate User
@enduml
